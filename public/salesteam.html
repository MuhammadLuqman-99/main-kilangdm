<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sales Team - Borang Lead & Power Metrics</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Unified Theme CSS -->
    <link rel="stylesheet" href="style/unified-theme.css">
    <link rel="stylesheet" href="style/responsive.css">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/improvements.css">
    <!-- MOBILE MENU FIX - Critical fix for mobile menu -->
    <link rel="stylesheet" href="style/mobile-menu-fix.css">
    <!-- UI COMPREHENSIVE FIX - Must be last for all UI/UX fixes -->
    <link rel="stylesheet" href="style/ui-fix-comprehensive.css">
    <!-- MOBILE ENHANCED - Advanced mobile optimizations -->
    <link rel="stylesheet" href="style/mobile-enhanced.css">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .form-input, .form-select {
            background-color: #374151; /* bg-gray-700 */
            border: 1px solid #4B5563; /* border-gray-600 */
            color: white;
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.75rem 1rem; /* px-4 py-3 */
            width: 100%;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3B82F6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 2px #1E40AF; /* focus:ring-blue-500 */
        }
        .form-select option {
            background-color: #374151;
            color: white;
        }
    </style>
</head>
<body>

    <!-- Floating Action Button for Home -->
    <div class="floating-home-btn">
        <button id="homeBtn" class="home-btn" title="Kembali ke Halaman Utama">
            <i class="fas fa-home"></i>
        </button>
    </div>

    <!-- Navigation Header -->
    <nav class="main-nav">
        <div class="nav-container">
            <!-- Brand Section -->
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="brand-text">
                    <h2>KilangDM</h2>
                    <span>Analytics Dashboard</span>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="nav-links" id="navLinks">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="dashboardbo.html" class="nav-link">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Order Dashboard</span>
                </a>
                <a href="ecommerce.html" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Borang Order</span>
                </a>
                <a href="marketing.html" class="nav-link ">
                    <i class="fas fa-bullhorn"></i>
                    <span>Marketing</span>
                </a>
                <a href="salesteam.html" class="nav-link active">
                    <i class="fas fa-users"></i>
                    <span>Sales Team</span>
                </a>
                <a href="followup.html" class="nav-link">
                    <i class="fas fa-phone"></i>
                    <span>Follow Up</span>
                </a>
                <a href="balance-monitor.html" class="nav-link" title="Full Screen Balance Monitor" target="_blank">
                    <i class="fas fa-tv"></i>
                    <span>Balance Monitor</span>
                </a>
            </div>

            <!-- Time Display -->
            <div class="nav-time">
                <div class="time-label">Last Updated</div>
                <div class="time-value" id="current-time">-</div>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-8">
        <!-- 👉 TAMBAH BREADCRUMB -->
        <div class="breadcrumb">
            <a href="index.html" class="breadcrumb-item">
                <i class="fas fa-home"></i> Home
            </a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item active">Sales Team</span>
        </div>

        <div class="grid lg:grid-cols-2 gap-6">
            <!-- Borang Lead -->
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <h2 class="text-2xl font-bold mb-6 text-center text-blue-400">
                    <i class="fas fa-user-plus mr-2"></i> Borang Lead
                    <i class="fas fa-info-circle ml-2 text-sm opacity-70" 
                    data-tooltip="Masukkan data lead mengikut slot masa yang ditetapkan"
                    data-tooltip-position="right"></i>
                </h2>
                    
                    <form id="lead-form" class="form-grid-2" data-validate>
                        <div>
                            <label for="lead-tarikh" class="block mb-2 font-medium">Tarikh</label>
                            <input type="date" 
                                id="lead-tarikh" 
                                name="tarikh" 
                                class="form-input" 
                                data-validate-field="required"
                                required>
                        </div>
                    <div>
                        <label for="lead-masa" class="block mb-2 font-medium">
                            Masa 
                            <i class="fas fa-clock" 
                            data-tooltip="Pilih slot masa untuk tracking lead yang betul"
                            data-tooltip-position="top"></i>
                        </label>
                        <select id="lead-masa" 
                                name="masa" 
                                class="form-select" 
                                data-validate-field="required"
                                required>
                            <option value="">Pilih Masa</option>
                            <option value="9.00am">9.00am</option>
                            <option value="2.30pm">2.30pm</option>
                            <option value="4.00pm">4.00pm</option>
                            <option value="8.30pm">8.30pm</option>
                        </select>
                    </div>

                    <div>
                        <label for="lead-team" class="block mb-2 font-medium">Nama Team Sale</label>
                        <select id="lead-team" 
                                name="team" 
                                class="form-select" 
                                data-validate-field="required"
                                required>
                            <option value="">Pilih Team</option>
                            <option value="Qilah">Qilah</option>
                            <option value="Wiyah">Wiyah</option>
                            <option value="Nisya">Nisya</option>
                        </select>
                    </div>

                    <div>
                       <label for="lead-total" class="block mb-2 font-medium">
                            Total Lead 
                            <i class="fas fa-users" 
                            data-tooltip="Jumlah keseluruhan lead yang diterima"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="lead-total" 
                            name="total_lead" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 20" 
                            required>
                    </div>
                    <div>
                        <label for="lead-cold" class="block mb-2 font-medium">
                            Cold Lead
                            <i class="fas fa-thermometer-empty" 
                            data-tooltip="Lead yang belum menunjukkan minat tinggi"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="lead-cold" 
                            name="cold" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 10" 
                            required>
                    </div>
                    <div>
                         <label for="lead-warm" class="block mb-2 font-medium">
                            Warm Lead
                            <i class="fas fa-thermometer-half" 
                            data-tooltip="Lead yang menunjukkan minat sederhana"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="lead-warm" 
                            name="warm" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 8" 
                            required>
                    </div>
                    <div>
                         <label for="lead-hot" class="block mb-2 font-medium">
                            Hot Lead
                            <i class="fas fa-thermometer-full" 
                            data-tooltip="Lead yang menunjukkan minat tinggi dan ready untuk beli"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="lead-hot" 
                            name="hot" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 2" 
                            required>
                    </div>
                    <div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                        <i class="fas fa-paper-plane mr-2"></i>
                                        Hantar Data Lead
                                    </button>                    
                    </div>
                </form>
                <div id="lead-feedback" class="mt-4 text-center"></div>
            </div>

            <!-- Borang Power Metrics -->
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <h2 class="text-2xl font-bold mb-6 text-center text-green-400">
                    <i class="fas fa-chart-line mr-2"></i> Borang Power Metrics
                    <i class="fas fa-info-circle ml-2 text-sm opacity-70" 
                    data-tooltip="Metrics bulanan untuk tracking performance team"
                    data-tooltip-position="left"></i>
                </h2>
                 <form id="metrics-form" class="form-grid-2" data-validate>
                    <div>
                        <label for="metrics-tarikh" class="block mb-2 font-medium">Tarikh</label>
                        <input type="date" 
                            id="metrics-tarikh" 
                            name="tarikh" 
                            class="form-input" 
                            data-validate-field="required"
                            required>
                    </div>

                    <div>
                        <label for="metrics-team" class="block mb-2 font-medium">Nama Team Sale</label>
                        <select id="metrics-team" 
                                name="team" 
                                class="form-select" 
                                data-validate-field="required"
                                required>
                            <option value="">Pilih Team</option>
                            <option value="Qilah">Qilah</option>
                            <option value="Wiyah">Wiyah</option>
                            <option value="Nisya">Nisya</option>
                        </select>
                    </div>

                    <div>
                        <label for="metrics-total-lead" class="block mb-2 font-medium">
                            Total Lead Bulan Ini
                            <i class="fas fa-calendar-alt" 
                            data-tooltip="Jumlah keseluruhan lead yang diterima untuk bulan semasa"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="metrics-total-lead" 
                            name="total_lead_bulan" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 150" 
                            required>
                    </div>

                    <div>
                         <label for="metrics-total-close" class="block mb-2 font-medium">
                            Total Close Bulan Ini
                            <i class="fas fa-handshake" 
                            data-tooltip="Jumlah lead yang berjaya di-convert kepada sales"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="metrics-total-close" 
                            name="total_close_bulan" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 25" 
                            required>
                    </div>

                    <div>
                         <label for="metrics-total-sale" class="block mb-2 font-medium">
                            Total Sale Bulan Ini (RM)
                            <i class="fas fa-money-bill-wave" 
                            data-tooltip="Jumlah nilai jualan dalam RM untuk bulan semasa"
                            data-tooltip-position="right"></i>
                        </label>
                        <input type="number" 
                            id="metrics-total-sale" 
                            name="total_sale_bulan" 
                            step="0.01" 
                            class="form-input" 
                            data-validate-field="required|numeric"
                            placeholder="e.g., 15000.00" 
                            required>
                    </div>

                    <div>
                        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                        <i class="fas fa-chart-bar mr-2"></i>
                                        Hantar Power Metrics
                        </button>                    
                    </div>
                </form>
                <div id="metrics-feedback" class="mt-4 text-center"></div>
            </div>

            <!-- 5. TAMBAH AUTO-CALCULATION FEATURE -->
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mt-8">
                <h3 class="text-xl font-bold mb-4 text-center text-yellow-400">
                    <i class="fas fa-calculator mr-2"></i>
                    Quick Calculator
                </h3>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="space-y-3">
                        <h4 class="font-semibold text-gray-300">Lead Distribution Check:</h4>
                        <div class="text-sm text-gray-400" id="lead-distribution-result">
                            Fill lead form to see distribution
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h4 class="font-semibold text-gray-300">Conversion Rate:</h4>
                        <div class="text-sm text-gray-400" id="conversion-rate-result">
                            Fill metrics form to see rate
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyANOj0x2Y2zpfaRR9tiLQxQ6BvFT1yGS04",
            authDomain: "kilangdm-v1.firebaseapp.com",
            projectId: "kilangdm-v1",
            storageBucket: "kilangdm-v1.firebasestorage.app",
            messagingSenderId: "264191193800",
            appId: "1:264191193800:web:0f3d9f25b9694c16bdabfd",
            measurementId: "G-C02S0CPE63"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        onAuthStateChanged(auth, (user) => {
            if (!user) { signInAnonymously(auth); }
        });
        
        window.db = db;
    </script>

    <!-- Sales Team JavaScript -->
    <script type="module" src="js/salesteam.js"></script>

    <!-- 👉 TAMBAH ENHANCED JS -->
    <script src="js/improvements.js"></script>

    <script>
        // Home button functionality
        document.getElementById('homeBtn').addEventListener('click', function() {
            // Replace with your actual homepage URL
            window.location.href = 'index.html';
        });

        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('mobile-active');
        });

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ms-MY', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }

        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();
    </script>

    <!-- 👉 TAMBAH SALES TEAM SPECIFIC ENHANCEMENTS -->
    <script>
        // Auto-calculate lead distribution
        function calculateLeadDistribution() {
            const total = parseInt(document.getElementById('lead-total').value) || 0;
            const cold = parseInt(document.getElementById('lead-cold').value) || 0;
            const warm = parseInt(document.getElementById('lead-warm').value) || 0;
            const hot = parseInt(document.getElementById('lead-hot').value) || 0;
            
            const sum = cold + warm + hot;
            const resultDiv = document.getElementById('lead-distribution-result');
            
            if (total > 0) {
                if (sum === total) {
                    resultDiv.innerHTML = `<span class="text-green-400"><i class="fas fa-check"></i> Distribution correct: ${cold}+${warm}+${hot} = ${total}</span>`;
                    resultDiv.className = 'text-sm text-green-400';
                } else {
                    resultDiv.innerHTML = `<span class="text-red-400"><i class="fas fa-exclamation-triangle"></i> Error: ${cold}+${warm}+${hot} = ${sum}, should be ${total}</span>`;
                    resultDiv.className = 'text-sm text-red-400';
                }
            } else {
                resultDiv.innerHTML = 'Fill lead form to see distribution';
                resultDiv.className = 'text-sm text-gray-400';
            }
        }
        
        // Auto-calculate conversion rate
        function calculateConversionRate() {
            const totalLead = parseInt(document.getElementById('metrics-total-lead').value) || 0;
            const totalClose = parseInt(document.getElementById('metrics-total-close').value) || 0;
            const resultDiv = document.getElementById('conversion-rate-result');
            
            if (totalLead > 0 && totalClose > 0) {
                const rate = ((totalClose / totalLead) * 100).toFixed(2);
                resultDiv.innerHTML = `<span class="text-blue-400"><i class="fas fa-percentage"></i> Conversion Rate: ${rate}%</span>`;
                
                // Color based on performance
                if (rate >= 20) {
                    resultDiv.className = 'text-sm text-green-400';
                } else if (rate >= 10) {
                    resultDiv.className = 'text-sm text-yellow-400';
                } else {
                    resultDiv.className = 'text-sm text-red-400';
                }
            } else {
                resultDiv.innerHTML = 'Fill metrics form to see rate';
                resultDiv.className = 'text-sm text-gray-400';
            }
        }
        
        // Add event listeners for real-time calculation
        document.addEventListener('DOMContentLoaded', function() {
            // Lead distribution calculator
            ['lead-total', 'lead-cold', 'lead-warm', 'lead-hot'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateLeadDistribution);
            });
            
            // Conversion rate calculator
            ['metrics-total-lead', 'metrics-total-close'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateConversionRate);
            });
        });
        
        // Enhanced form submissions
        document.getElementById('lead-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate lead distribution first
            const total = parseInt(document.getElementById('lead-total').value) || 0;
            const cold = parseInt(document.getElementById('lead-cold').value) || 0;
            const warm = parseInt(document.getElementById('lead-warm').value) || 0;
            const hot = parseInt(document.getElementById('lead-hot').value) || 0;
            
            if (cold + warm + hot !== total) {
                console.log('❌ Lead distribution tidak betul! Cold + Warm + Hot mesti sama dengan Total Lead.');
                return;
            }
            
            console.log('💾 Menyimpan data lead...');
            
            // Simulate save process
            setTimeout(() => {
                // Loading hidden
                console.log('✅ Data lead berjaya disimpan!');
                this.reset();
                calculateLeadDistribution();
            }, 2000);
        });
        
        document.getElementById('metrics-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('💾 Menyimpan power metrics...');
            
            // Simulate save process
            setTimeout(() => {
                // Loading hidden
                console.log('✅ Power metrics berjaya disimpan!');
                this.reset();
                calculateConversionRate();
            }, 2500);
        });
        
        // Set today's date as default
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('lead-tarikh').value = today;
            document.getElementById('metrics-tarikh').value = today;
            
            // Welcome notification
            setTimeout(() => {
                console.log('ℹ️ Sales Team dashboard loaded!');
            }, 500);
        });
    </script>
    
    <!-- Responsive Enhancement Script -->
    <script src="js/responsive-enhancements.js"></script>
    
    <!-- UI Interactions - Enhanced user experience -->
    <script src="js/ui-interactions.js"></script>
</body>
</html>