<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Dashboard - KilangDM</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
   <!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

    const firebaseConfig = {
        apiKey: "AIzaSyANOj0x2Y2zpfaRR9tiLQxQ6BvFT1yGS04",
        authDomain: "kilangdm-v1.firebaseapp.com",
        projectId: "kilangdm-v1",
        storageBucket: "kilangdm-v1.firebasestorage.app",
        messagingSenderId: "264191193800",
        appId: "1:264191193800:web:0f3d9f25b9694c16bdabfd",
        measurementId: "G-C02S0CPE63"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    window.db = getFirestore(app);
    
    console.log('Firebase initialized successfully');
</script>
</head>
<body>
    <!-- Floating Action Button for Home -->
    <div class="floating-home-btn">
        <button id="homeBtn" class="home-btn" title="Kembali ke Halaman Utama">
            <i class="fas fa-home"></i>
        </button>
    </div>

    <!-- Navigation Header -->
    <nav class="main-nav">
        <div class="nav-container">
            <!-- Brand Section -->
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="brand-text">
                    <h2>KilangDM</h2>
                    <span>Analytics Dashboard</span>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="nav-links" id="navLinks">
                <a href="dashboard.html" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="dashboardbo.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard Order</span>
                </a>
                <a href="ecommerce.html" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Borang Order</span>
                </a>
                <a href="marketing.html" class="nav-link">
                    <i class="fas fa-bullhorn"></i>
                    <span>Marketing</span>
                </a>
                <a href="salesteam.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Sales Team</span>
                </a>
                <a href="followup.html" class="nav-link">
                    <i class="fas fa-phone"></i>
                    <span>Follow Up</span>
                </a>
            </div>

            <!-- Time Display -->
            <div class="nav-time">
                <div class="time-label">Last Updated</div>
                <div class="time-value" id="current-time">-</div>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Dashboard Header -->
        <section class="dashboard-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="page-title">Analytics Dashboard</h1>
                    <p class="page-subtitle">Comprehensive Business Intelligence & Performance Metrics</p>
                </div>
                <div class="header-right">
                    <div class="header-stats">
                        <div class="stat-item">
                            <span class="stat-label">Target Bulanan</span>
                            <span class="stat-value">RM 15,000</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-item">
                            <span class="stat-label">Status</span>
                            <span class="stat-value status-active">
                                <i class="fas fa-circle"></i>
                                Live
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Filter Section -->
        <section class="filter-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Data Filters</h3>
                    <p class="section-subtitle">Customize your analytics view</p>
                </div>
                <div class="section-actions">
                    <button id="clear-filter" class="btn btn-outline btn-sm">
                        <i class="fas fa-refresh"></i>
                        Reset
                    </button>
                </div>
            </div>
            
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">Tarikh Mula</label>
                    <input type="date" id="start-date" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Tarikh Akhir</label>
                    <input type="date" id="end-date" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Team</label>
                    <select id="agent-filter" class="filter-select">
                        <option value="">Semua Agent</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button id="apply-filter" class="btn btn-primary">
                        <i class="fas fa-filter"></i>
                        Terapkan Filter
                    </button>
                </div>
            </div>
            
            <div id="active-filters" class="active-filters hidden">
                <div class="filter-summary">
                    <span class="summary-label">Filter Aktif:</span>
                    <div id="filter-tags" class="filter-tags"></div>
                </div>
            </div>
        </section>

        <!-- Key Performance Indicators -->
        <section class="kpi-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Key Performance Indicators</h3>
                    <p class="section-subtitle">Real-time business metrics</p>
                </div>
            </div>

            <div class="kpi-grid">
                <!-- Total Sales -->
                <div class="kpi-card sales-card">
                    <div class="kpi-header">
                        <div class="kpi-icon sales-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <span class="kpi-trend" id="sales-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Total Sales</h4>
                        <p class="kpi-value" id="total-sales">RM 0.00</p>
                        <p class="kpi-meta" id="total-sales-count">0 entri</p>
                    </div>
                </div>

                <!-- Average ROAS -->
                <div class="kpi-card roas-card">
                    <div class="kpi-header">
                        <div class="kpi-icon roas-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span class="kpi-trend" id="roas-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Average ROAS</h4>
                        <p class="kpi-value" id="avg-roas">0.0x</p>
                        <p class="kpi-meta" id="avg-roas-count">0 entri</p>
                    </div>
                </div>

                <!-- Leads per Agent -->
                <div class="kpi-card leads-card">
                    <div class="kpi-header">
                        <div class="kpi-icon leads-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="kpi-trend" id="leads-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Leads per Agent</h4>
                        <p class="kpi-value" id="leads-per-agent">0</p>
                        <p class="kpi-meta" id="leads-per-agent-count">0 agent</p>
                    </div>
                </div>

                <!-- Total Orders -->
                <div class="kpi-card orders-card">
                    <div class="kpi-header">
                        <div class="kpi-icon orders-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <span class="kpi-trend" id="orders-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Total Orders</h4>
                        <p class="kpi-value" id="total-orders">0</p>
                        <p class="kpi-meta" id="total-orders-count">0 orders</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Power Metrics Section -->
        <section class="power-metrics-section">
            <div class="section-header">
                <div class="header-left">
                    <div class="header-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div>
                        <h3 class="section-title">Power Metrics</h3>
                        <p class="section-subtitle">Advanced KPI & Performance Tracking</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="target-info">
                        <span class="target-label">Sasaran Bulanan</span>
                        <span class="target-value">RM 15,000</span>
                    </div>
                </div>
            </div>

            <!-- Primary Metrics -->
            <div class="power-grid">
                <div class="metric-card primary-metric kpi-harian">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <span class="metric-status" id="kpi-harian-status">Target</span>
                    </div>
                    <h4 class="metric-title">KPI Harian</h4>
                    <p class="metric-value" id="kpi-harian">RM 0</p>
                    <p class="metric-desc" id="kpi-harian-desc">per hari kerja</p>
                </div>

                <div class="metric-card primary-metric kpi-mtd">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <span class="metric-status" id="kpi-mtd-status">MTD</span>
                    </div>
                    <h4 class="metric-title">KPI MTD</h4>
                    <p class="metric-value" id="kpi-mtd">RM 0</p>
                    <p class="metric-desc" id="kpi-mtd-desc">sasaran bulan ini</p>
                </div>

                <div class="metric-card primary-metric sale-mtd">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="metric-status" id="sale-mtd-trend">Actual</span>
                    </div>
                    <h4 class="metric-title">Sale MTD</h4>
                    <p class="metric-value" id="sale-mtd">RM 0</p>
                    <p class="metric-desc" id="sale-mtd-desc">jualan sebenar</p>
                </div>

                <div class="metric-card primary-metric balance-bulanan">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <span class="metric-status" id="balance-bulanan-status">Balance</span>
                    </div>
                    <h4 class="metric-title">Balance Bulanan</h4>
                    <p class="metric-value" id="balance-bulanan">RM 0</p>
                    <p class="metric-desc" id="balance-bulanan-desc">perlu dicapai</p>
                </div>
            </div>

            <!-- Secondary Metrics -->
            <div class="power-grid secondary-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-trending-up"></i>
                        </div>
                        <span class="metric-status" id="balance-mtd-status">Gap</span>
                    </div>
                    <h4 class="metric-title">Balance MTD</h4>
                    <p class="metric-value" id="balance-mtd">RM 0</p>
                    <p class="metric-desc" id="balance-mtd-desc">gap sasaran</p>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <span class="metric-status" id="bilangan-terjual-trend">Sales</span>
                    </div>
                    <h4 class="metric-title">Bilangan Terjual</h4>
                    <p class="metric-value" id="bilangan-terjual">0</p>
                    <p class="metric-desc" id="bilangan-terjual-desc">unit terjual</p>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <span class="metric-status" id="close-rate-status">Rate</span>
                    </div>
                    <h4 class="metric-title">Total Close %</h4>
                    <p class="metric-value" id="total-close-rate">0%</p>
                    <p class="metric-desc" id="total-close-rate-desc">conversion rate</p>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-business-time"></i>
                        </div>
                        <span class="metric-status" id="working-days-status">Days</span>
                    </div>
                    <h4 class="metric-title">Hari Kerja</h4>
                    <p class="metric-value" id="working-days-info">0 / 0</p>
                    <p class="metric-desc" id="working-days-desc">hari ini / total</p>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Progress Bulanan</span>
                        <span class="progress-value" id="monthly-progress-text">0% (RM 0 / RM 15,000)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill monthly-progress" style="width: 0%" id="monthly-progress-bar"></div>
                    </div>
                </div>

                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Progress MTD</span>
                        <span class="progress-value" id="mtd-progress-text">0% (RM 0 / RM 0)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill mtd-progress" style="width: 0%" id="mtd-progress-bar"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Charts Section -->
        <section class="charts-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Analytics Charts</h3>
                    <p class="section-subtitle">Visual data representation</p>
                </div>
            </div>

            <div class="charts-grid">
                <!-- Main Sales Trend Chart -->
                <div class="chart-card main-chart">
                    <div class="chart-header">
                        <h4 class="chart-title">Sales Trend Analysis</h4>
                        <div class="chart-controls">
                            <button class="period-btn active" data-period="7">7 Hari</button>
                            <button class="period-btn" data-period="30">30 Hari</button>
                            <button class="period-btn" data-period="90">90 Hari</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>

                <!-- Lead Distribution Chart -->
                <div class="chart-card main-chart enhanced-leads-chart">
                    <div class="chart-header">
                        <div class="header-left">
                            <h4 class="chart-title">
                                <i class="fas fa-users-cog mr-2"></i>
                                Lead Distribution Analysis
                            </h4>
                            <p class="chart-subtitle">Sales Team + Marketing Lead Breakdown</p>
                        </div>
                        <div class="chart-badge">
                            <span class="badge-live">
                                <i class="fas fa-circle animate-pulse"></i>
                                Real-time Data
                            </span>
                        </div>
                    </div>
                    
                    <div class="chart-container enhanced-chart-container">
                        <canvas id="leadsChart"></canvas>
                    </div>
                </div>

                <!-- Marketing Cost Analysis Chart -->
                <div class="chart-card main-chart enhanced-cost-chart">
                    <div class="chart-header">
                        <div class="header-left">
                            <h4 class="chart-title">
                                <i class="fas fa-dollar-sign mr-2"></i>
                                Marketing Cost Analysis
                            </h4>
                            <p class="chart-subtitle">Cost per Lead & Total Spend Tracking</p>
                        </div>
                    </div>
                    
                    <div class="chart-container enhanced-chart-container">
                        <canvas id="costPerLeadChart"></canvas>
                    </div>
                </div>

                <!-- Smaller Charts -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Sales by Channel</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="channelChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Team Performance</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="teamChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Marketing Spend</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="spendChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Lead Quality Trends</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="leadQualityChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="activity-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Recent Activity</h3>
                    <p class="section-subtitle">Latest business activities and updates</p>
                </div>
                <div class="section-actions">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-refresh"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div class="activity-feed" id="activity-feed">
                <div class="activity-loading">
                    <div class="loading-spinner"></div>
                    <span>Loading recent activities...</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Load Dashboard JavaScript -->
    <script type="module" src="js/dashboard.js"></script>
    <script src="js/ready-sync.js"></script>
    <script>
        // Home button functionality
        document.getElementById('homeBtn').addEventListener('click', function() {
            // Replace with your actual homepage URL
            window.location.href = 'index.html';
        });

        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('mobile-active');
        });

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ms-MY', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }

        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();
    </script>
</body>
</html>