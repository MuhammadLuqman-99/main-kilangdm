<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Enhanced Dashboard - KilangDM</title>
    <link rel="stylesheet" href="style/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
   <!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

    const firebaseConfig = {
        apiKey: "AIzaSyANOj0x2Y2zpfaRR9tiLQxQ6BvFT1yGS04",
        authDomain: "kilangdm-v1.firebaseapp.com",
        projectId: "kilangdm-v1",
        storageBucket: "kilangdm-v1.firebasestorage.app",
        messagingSenderId: "264191193800",
        appId: "1:264191193800:web:0f3d9f25b9694c16bdabfd",
        measurementId: "G-C02S0CPE63"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    window.db = getFirestore(app);
    
    console.log('Firebase initialized successfully');
</script>
</head>
<body>
    <!-- Floating Action Button for Home -->
    <div class="floating-home-btn">
        <button id="homeBtn" class="home-btn" title="Kembali ke Halaman Utama">
            <i class="fas fa-home"></i>
        </button>
    </div>

    <!-- Navigation Header -->
    <nav class="main-nav">
        <div class="nav-container">
            <!-- Brand Section -->
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="brand-text">
                    <h2>KilangDM</h2>
                    <span>Analytics Dashboard</span>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="nav-links" id="navLinks">
                <a href="dashboard.html" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="dashboardbo.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard Order</span>
                </a>
                <a href="ecommerce.html" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Borang Order</span>
                </a>
                <a href="marketing.html" class="nav-link">
                    <i class="fas fa-bullhorn"></i>
                    <span>Marketing</span>
                </a>
                <a href="salesteam.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Sales Team</span>
                </a>
                <a href="followup.html" class="nav-link">
                    <i class="fas fa-phone"></i>
                    <span>Follow Up</span>
                </a>
            </div>

            <!-- Time Display -->
            <div class="nav-time">
                <div class="time-label">Last Updated</div>
                <div class="time-value" id="current-time">-</div>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Dashboard Header -->
        <section class="dashboard-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="page-title">Analytics Dashboard</h1>
                    <p class="page-subtitle">Comprehensive Business Intelligence & Performance Metrics</p>
                </div>
                <div class="header-right">
                    <div class="header-stats">
                        <div class="stat-item">
                            <span class="stat-label">Target Bulanan</span>
                            <span class="stat-value">RM 15,000</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-item">
                            <span class="stat-label">Status</span>
                            <span class="stat-value status-active">
                                <i class="fas fa-circle"></i>
                                Live
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==========================================
        REPLACE EXISTING FILTER SECTION IN dashboard.html
        Replace the entire <section class="filter-section"> with this:
        ========================================== -->

        <section class="filter-section enhanced">
        <div class="enhanced-date-filter">
            <div class="filter-header">
                <i class="fas fa-calendar-alt"></i>
                <h3>Data Period Selection</h3>
            </div>
            
            <div class="filter-content">
                <!-- Filter Type Selector -->
                <div class="filter-type-selector">
                    <div class="filter-tab-nav">
                        <button class="filter-tab active" data-type="quick">
                            <i class="fas fa-bolt"></i>
                            Quick Select
                        </button>
                        <button class="filter-tab" data-type="advanced">
                            <i class="fas fa-cog"></i>
                            Advanced
                        </button>
                        <button class="filter-tab" data-type="custom">
                            <i class="fas fa-calendar-plus"></i>
                            Custom Range
                        </button>
                    </div>
                </div>

                <!-- Quick Select Tab -->
                <div class="filter-tab-content active" id="quick-tab">
                    <div class="quick-select-grid">
                        <button class="quick-btn" data-period="today">
                            <i class="fas fa-sun"></i>
                            <span>Today</span>
                            <small id="today-label">-</small>
                        </button>
                        <button class="quick-btn" data-period="yesterday">
                            <i class="fas fa-moon"></i>
                            <span>Yesterday</span>
                            <small id="yesterday-label">-</small>
                        </button>
                        <button class="quick-btn" data-period="this-week">
                            <i class="fas fa-calendar-week"></i>
                            <span>This Week</span>
                            <small id="thisweek-label">-</small>
                        </button>
                        <button class="quick-btn" data-period="last-week">
                            <i class="fas fa-calendar-minus"></i>
                            <span>Last Week</span>
                            <small id="lastweek-label">-</small>
                        </button>
                        <button class="quick-btn active" data-period="this-month">
                            <i class="fas fa-calendar"></i>
                            <span>This Month</span>
                            <small id="thismonth-label">-</small>
                        </button>
                        <button class="quick-btn" data-period="last-month">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Last Month</span>
                            <small id="lastmonth-label">-</small>
                        </button>
                        <button class="quick-btn" data-period="this-year">
                            <i class="fas fa-calendar-check"></i>
                            <span>This Year</span>
                            <small id="thisyear-label">-</small>
                        </button>
                        <button class="quick-btn" data-period="last-year">
                            <i class="fas fa-history"></i>
                            <span>Last Year</span>
                            <small id="lastyear-label">-</small>
                        </button>
                    </div>
                </div>

                <!-- Advanced Select Tab -->
                <div class="filter-tab-content" id="advanced-tab">
                    <div class="advanced-filter-grid">
                        <!-- Year Selector -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar-check"></i>
                                Pilih Tahun
                            </label>
                            <select id="year-selector" class="filter-select">
                                <option value="">Semua Tahun</option>
                            </select>
                        </div>

                        <!-- Month Selector -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar"></i>
                                Pilih Bulan
                            </label>
                            <select id="month-selector" class="filter-select" disabled>
                                <option value="">Semua Bulan</option>
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Mac</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Jun</option>
                                <option value="7">Julai</option>
                                <option value="8">Ogos</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Disember</option>
                            </select>
                        </div>

                        <!-- Day Range Selector -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar-day"></i>
                                Julat Hari (Optional)
                            </label>
                            <div class="day-range-inputs">
                                <input type="number" id="start-day" class="filter-input" placeholder="Dari hari" min="1" max="31" disabled>
                                <span class="range-separator">hingga</span>
                                <input type="number" id="end-day" class="filter-input" placeholder="Hingga hari" min="1" max="31" disabled>
                            </div>
                        </div>

                        <!-- Quick Month Buttons -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-mouse-pointer"></i>
                                Quick Month Select
                            </label>
                            <div class="month-quick-grid" id="month-quick-grid">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Custom Range Tab -->
                <div class="filter-tab-content" id="custom-tab">
                    <div class="custom-range-grid">
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar-plus"></i>
                                Tarikh Mula
                            </label>
                            <input type="date" id="custom-start-date" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar-minus"></i>
                                Tarikh Tamat
                            </label>
                            <input type="date" id="custom-end-date" class="filter-input">
                        </div>
                    </div>
                </div>

                <!-- Agent Filter (Common for all tabs) -->
                <div class="agent-filter-section">
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-users"></i>
                            Filter Team/Agent
                        </label>
                        <select id="agent-filter-enhanced" class="filter-select">
                            <option value="">Semua Agent</option>
                        </select>
                    </div>
                </div>
                
                <!-- Selected Period Display -->
                <div class="selected-period" id="selectedPeriod">
                    <div class="period-info">
                        <div class="period-title" id="periodTitle">This Month</div>
                        <div class="period-range" id="periodRange">Current month data</div>
                        <div class="period-stats" id="periodStats">
                            <span class="stat-item">
                                <i class="fas fa-calendar-day"></i>
                                <span id="period-days">0 hari</span>
                            </span>
                            <span class="stat-item">
                                <i class="fas fa-business-time"></i>
                                <span id="period-working-days">0 hari kerja</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn btn-primary" id="applyFilterEnhanced">
                    <i class="fas fa-filter"></i>
                    Apply Filter
                </button>
                <button class="btn btn-secondary" id="resetFilterEnhanced">
                    <i class="fas fa-refresh"></i>
                    Reset
                </button>
                <button class="btn btn-outline" id="exportDataBtn">
                    <i class="fas fa-download"></i>
                    Export Data
                </button>
            </div>
            
            <div id="activeFiltersEnhanced" class="active-filters enhanced-active-filters hidden">
                <div class="filter-summary">
                    <span class="summary-label">Filter Aktif:</span>
                    <div id="filterTagsEnhanced" class="filter-tags"></div>
                </div>
            </div>
        </div>
    </section>

        <!-- Key Performance Indicators -->
        <section class="kpi-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Key Performance Indicators</h3>
                    <p class="section-subtitle">Real-time business metrics</p>
                </div>
            </div>

            <div class="kpi-grid">
                <!-- Total Sales -->
                <div class="kpi-card sales-card">
                    <div class="kpi-header">
                        <div class="kpi-icon sales-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <span class="kpi-trend" id="sales-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Total Sales</h4>
                        <p class="kpi-value" id="total-sales">RM 0.00</p>
                        <p class="kpi-meta" id="total-sales-count">0 entri</p>
                    </div>
                </div>

                <!-- Average ROAS -->
                <div class="kpi-card roas-card">
                    <div class="kpi-header">
                        <div class="kpi-icon roas-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span class="kpi-trend" id="roas-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Average ROAS</h4>
                        <p class="kpi-value" id="avg-roas">0.0x</p>
                        <p class="kpi-meta" id="avg-roas-count">0 entri</p>
                    </div>
                </div>

                <!-- Leads per Agent -->
                <div class="kpi-card leads-card">
                    <div class="kpi-header">
                        <div class="kpi-icon leads-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="kpi-trend" id="leads-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Leads per Agent</h4>
                        <p class="kpi-value" id="leads-per-agent">0</p>
                        <p class="kpi-meta" id="leads-per-agent-count">0 agent</p>
                    </div>
                </div>

                <!-- Total Orders -->
                <div class="kpi-card orders-card">
                    <div class="kpi-header">
                        <div class="kpi-icon orders-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <span class="kpi-trend" id="orders-trend">-</span>
                    </div>
                    <div class="kpi-content">
                        <h4 class="kpi-title">Total Orders</h4>
                        <p class="kpi-value" id="total-orders">0</p>
                        <p class="kpi-meta" id="total-orders-count">0 orders</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Power Metrics Section -->
        <section class="power-metrics-section">
            <div class="section-header">
                <div class="header-left">
                    <div class="header-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div>
                        <h3 class="section-title">Power Metrics</h3>
                        <p class="section-subtitle">Advanced KPI & Performance Tracking</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="target-info">
                        <span class="target-label">Sasaran Bulanan</span>
                        <span class="target-value">RM 15,000</span>
                    </div>
                </div>
            </div>

            <!-- Primary Metrics -->
            <div class="power-grid">
                <div class="metric-card primary-metric kpi-harian">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <span class="metric-status" id="kpi-harian-status">Target</span>
                    </div>
                    <h4 class="metric-title">KPI Harian</h4>
                    <p class="metric-value" id="kpi-harian">RM 0</p>
                    <p class="metric-desc" id="kpi-harian-desc">per hari kerja</p>
                </div>

                <div class="metric-card primary-metric kpi-mtd">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <span class="metric-status" id="kpi-mtd-status">MTD</span>
                    </div>
                    <h4 class="metric-title">KPI MTD</h4>
                    <p class="metric-value" id="kpi-mtd">RM 0</p>
                    <p class="metric-desc" id="kpi-mtd-desc">sasaran bulan ini</p>
                </div>

                <div class="metric-card primary-metric sale-mtd">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="metric-status" id="sale-mtd-trend">Actual</span>
                    </div>
                    <h4 class="metric-title">Sale MTD</h4>
                    <p class="metric-value" id="sale-mtd">RM 0</p>
                    <p class="metric-desc" id="sale-mtd-desc">jualan sebenar</p>
                </div>

                <div class="metric-card primary-metric balance-bulanan">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <span class="metric-status" id="balance-bulanan-status">Balance</span>
                    </div>
                    <h4 class="metric-title">Balance Bulanan</h4>
                    <p class="metric-value" id="balance-bulanan">RM 0</p>
                    <p class="metric-desc" id="balance-bulanan-desc">perlu dicapai</p>
                </div>
            </div>

            <!-- Secondary Metrics -->
            <div class="power-grid secondary-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-trending-up"></i>
                        </div>
                        <span class="metric-status" id="balance-mtd-status">Gap</span>
                    </div>
                    <h4 class="metric-title">Balance MTD</h4>
                    <p class="metric-value" id="balance-mtd">RM 0</p>
                    <p class="metric-desc" id="balance-mtd-desc">gap sasaran</p>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <span class="metric-status" id="bilangan-terjual-trend">Sales</span>
                    </div>
                    <h4 class="metric-title">Bilangan Terjual</h4>
                    <p class="metric-value" id="bilangan-terjual">0</p>
                    <p class="metric-desc" id="bilangan-terjual-desc">unit terjual</p>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <span class="metric-status" id="close-rate-status">Rate</span>
                    </div>
                    <h4 class="metric-title">Total Close %</h4>
                    <p class="metric-value" id="total-close-rate">0%</p>
                    <p class="metric-desc" id="total-close-rate-desc">conversion rate</p>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-business-time"></i>
                        </div>
                        <span class="metric-status" id="working-days-status">Days</span>
                    </div>
                    <h4 class="metric-title">Hari Kerja</h4>
                    <p class="metric-value" id="working-days-info">0 / 0</p>
                    <p class="metric-desc" id="working-days-desc">hari ini / total</p>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Progress Bulanan</span>
                        <span class="progress-value" id="monthly-progress-text">0% (RM 0 / RM 15,000)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill monthly-progress" style="width: 0%" id="monthly-progress-bar"></div>
                    </div>
                </div>

                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Progress MTD</span>
                        <span class="progress-value" id="mtd-progress-text">0% (RM 0 / RM 0)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill mtd-progress" style="width: 0%" id="mtd-progress-bar"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Charts Section -->
        <section class="charts-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Analytics Charts</h3>
                    <p class="section-subtitle">Visual data representation</p>
                </div>
            </div>

            <div class="charts-grid">
                <!-- Main Sales Trend Chart -->
                <div class="chart-card main-chart">
                    <div class="chart-header">
                        <h4 class="chart-title">Sales Trend Analysis</h4>
                        <div class="chart-controls">
                            <button class="period-btn active" data-period="7">7 Hari</button>
                            <button class="period-btn" data-period="30">30 Hari</button>
                            <button class="period-btn" data-period="90">90 Hari</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>

                <!-- Lead Distribution Chart -->
                <div class="chart-card main-chart enhanced-leads-chart">
                    <div class="chart-header">
                        <div class="header-left">
                            <h4 class="chart-title">
                                <i class="fas fa-users-cog mr-2"></i>
                                Lead Distribution Analysis
                            </h4>
                            <p class="chart-subtitle">Sales Team + Marketing Lead Breakdown</p>
                        </div>
                        <div class="chart-badge">
                            <span class="badge-live">
                                <i class="fas fa-circle animate-pulse"></i>
                                Real-time Data
                            </span>
                        </div>
                    </div>
                    
                    <!-- SIMPLIFIED: Direct chart container - no filters -->
                    <div class="chart-container enhanced-chart-container">
                        <canvas id="leadsChart"></canvas>
                    </div>
                </div>

                <!-- Marketing Cost Analysis Chart -->
                <div class="chart-card main-chart enhanced-cost-chart">
                    <div class="chart-header">
                        <div class="header-left">
                            <h4 class="chart-title">
                                <i class="fas fa-dollar-sign mr-2"></i>
                                Marketing Cost Analysis
                            </h4>
                            <p class="chart-subtitle">Cost per Lead & Total Spend Tracking</p>
                        </div>
                    </div>
                    
                    <div class="chart-container enhanced-chart-container">
                        <canvas id="costPerLeadChart"></canvas>
                    </div>
                </div>

                <!-- Smaller Charts -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Sales by Channel</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="channelChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Team Performance</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="teamChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Marketing Spend</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="spendChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Lead Quality Trends</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="leadQualityChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="activity-section">
            <div class="section-header">
                <div class="header-left">
                    <h3 class="section-title">Recent Activity</h3>
                    <p class="section-subtitle">Latest business activities and updates</p>
                </div>
                <div class="section-actions">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-refresh"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div class="activity-feed" id="activity-feed">
                <div class="activity-loading">
                    <div class="loading-spinner"></div>
                    <span>Loading recent activities...</span>
                </div>
            </div>
        </section>
    </main>
    <style>
/* Advanced Filter Styles */
.filter-section.enhanced {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 32px;
    border: 1px solid #374151;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.filter-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #374151;
}

.filter-header i {
    color: #3B82F6;
    font-size: 20px;
}

.filter-header h3 {
    color: #F9FAFB;
    font-size: 18px;
    font-weight: 600;
    margin: 0;
}

/* Tab Navigation */
.filter-tab-nav {
    display: flex;
    background: #374151;
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 24px;
    gap: 4px;
}

.filter-tab {
    flex: 1;
    padding: 12px 16px;
    background: transparent;
    border: none;
    border-radius: 8px;
    color: #9CA3AF;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.filter-tab:hover {
    color: #D1D5DB;
    background: rgba(59, 130, 246, 0.1);
}

.filter-tab.active {
    background: #3B82F6;
    color: #FFFFFF;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.filter-tab i {
    font-size: 14px;
}

/* Tab Content */
.filter-tab-content {
    display: none;
}

.filter-tab-content.active {
    display: block;
}

/* Quick Select Grid */
.quick-select-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 24px;
}

.quick-btn {
    background: #374151;
    border: 2px solid #4B5563;
    border-radius: 12px;
    padding: 16px 12px;
    color: #D1D5DB;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.quick-btn:hover {
    border-color: #3B82F6;
    background: rgba(59, 130, 246, 0.1);
    transform: translateY(-2px);
}

.quick-btn.active {
    background: #3B82F6;
    border-color: #60A5FA;
    color: #FFFFFF;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.quick-btn i {
    font-size: 20px;
    margin-bottom: 4px;
}

.quick-btn span {
    font-weight: 600;
    font-size: 14px;
}

.quick-btn small {
    font-size: 11px;
    opacity: 0.8;
    font-weight: 400;
}

/* Advanced Filter Grid */
.advanced-filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.filter-label {
    color: #F3F4F6;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-label i {
    color: #3B82F6;
    font-size: 14px;
}

.filter-select, .filter-input {
    background: #374151;
    border: 2px solid #4B5563;
    border-radius: 8px;
    padding: 12px 16px;
    color: #F9FAFB;
    font-size: 14px;
    transition: all 0.3s ease;
}

.filter-select:focus, .filter-input:focus {
    outline: none;
    border-color: #3B82F6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.filter-select:disabled, .filter-input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.filter-select option {
    background: #374151;
    color: #F9FAFB;
}

/* Day Range Inputs */
.day-range-inputs {
    display: flex;
    align-items: center;
    gap: 12px;
}

.range-separator {
    color: #9CA3AF;
    font-size: 14px;
    font-weight: 500;
}

.day-range-inputs .filter-input {
    flex: 1;
}

/* Month Quick Grid */
.month-quick-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.month-quick-btn {
    background: #4B5563;
    border: 1px solid #6B7280;
    border-radius: 8px;
    padding: 8px 12px;
    color: #D1D5DB;
    font-size: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.month-quick-btn:hover {
    border-color: #3B82F6;
    background: rgba(59, 130, 246, 0.1);
}

.month-quick-btn.active {
    background: #3B82F6;
    border-color: #60A5FA;
    color: #FFFFFF;
}

/* Custom Range Grid */
.custom-range-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
}

/* Agent Filter Section */
.agent-filter-section {
    background: rgba(75, 85, 99, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin: 24px 0;
    border: 1px solid #4B5563;
}

/* Selected Period Display */
.selected-period {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    border-radius: 12px;
    padding: 20px;
    margin: 24px 0;
    border: 1px solid #10B981;
}

.period-info {
    text-align: center;
}

.period-title {
    color: #FFFFFF;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
}

.period-range {
    color: #D1FAE5;
    font-size: 14px;
    margin-bottom: 16px;
}

.period-stats {
    display: flex;
    justify-content: center;
    gap: 24px;
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 6px;
    color: #ECFDF5;
    font-size: 13px;
}

.stat-item i {
    color: #A7F3D0;
}

/* Filter Actions */
.filter-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 24px;
}

.btn {
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: #3B82F6;
    color: #FFFFFF;
}

.btn-primary:hover {
    background: #2563EB;
    transform: translateY(-1px);
}

.btn-secondary {
    background: #6B7280;
    color: #FFFFFF;
}

.btn-secondary:hover {
    background: #4B5563;
}

.btn-outline {
    background: transparent;
    color: #3B82F6;
    border: 2px solid #3B82F6;
}

.btn-outline:hover {
    background: #3B82F6;
    color: #FFFFFF;
}

/* Active Filters */
.active-filters {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid #3B82F6;
    border-radius: 12px;
    padding: 16px;
    margin-top: 20px;
}

.filter-summary {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.summary-label {
    color: #3B82F6;
    font-weight: 600;
    font-size: 14px;
}

.filter-tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.filter-tag {
    background: #3B82F6;
    color: #FFFFFF;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.remove-tag {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    color: #FFFFFF;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.remove-tag:hover {
    background: rgba(255, 255, 255, 0.3);
}

.hidden {
    display: none !important;
}

/* Responsive */
@media (max-width: 768px) {
    .advanced-filter-grid {
        grid-template-columns: 1fr;
    }
    
    .custom-range-grid {
        grid-template-columns: 1fr;
    }
    
    .quick-select-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .filter-actions {
        flex-direction: column;
    }
    
    .btn {
        justify-content: center;
    }
}
</style>

    <!-- Load Dashboard JavaScript -->
    <script type="module" src="js/dashboard.js"></script>
    <script src="js/ready-sync.js"></script>
    <script src="js/enhanced-filter.js"></script>
    <script> 
        // Home button functionality
        document.getElementById('homeBtn').addEventListener('click', function() {
            // Replace with your actual homepage URL
            window.location.href = 'index.html';
        });

        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('mobile-active');
        });

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ms-MY', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }

        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();
    </script>
    <script>
        // Advanced Dashboard Filter Controller
class AdvancedDashboardFilter {
    constructor() {
        this.currentTab = 'quick';
        this.currentSelection = {
            type: 'quick',
            value: 'this-month',
            year: null,
            month: null,
            startDay: null,
            endDay: null,
            customStart: null,
            customEnd: null,
            agent: null
        };
        
        this.init();
        this.populateYearSelector();
        this.updateQuickLabels();
        this.setDefaultSelection();
    }

    init() {
        // Tab switching
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                this.switchTab(tab.dataset.type);
            });
        });

        // Quick select buttons
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.selectQuickPeriod(btn.dataset.period);
            });
        });

        // Advanced selectors
        document.getElementById('year-selector')?.addEventListener('change', () => {
            this.onYearChange();
        });

        document.getElementById('month-selector')?.addEventListener('change', () => {
            this.onMonthChange();
        });

        // Day range inputs
        document.getElementById('start-day')?.addEventListener('change', () => {
            this.onDayRangeChange();
        });

        document.getElementById('end-day')?.addEventListener('change', () => {
            this.onDayRangeChange();
        });

        // Custom date inputs
        document.getElementById('custom-start-date')?.addEventListener('change', () => {
            this.onCustomDateChange();
        });

        document.getElementById('custom-end-date')?.addEventListener('change', () => {
            this.onCustomDateChange();
        });

        // Agent filter
        document.getElementById('agent-filter-enhanced')?.addEventListener('change', () => {
            this.onAgentChange();
        });

        // Action buttons
        document.getElementById('applyFilterEnhanced')?.addEventListener('click', () => {
            this.applyFilter();
        });

        document.getElementById('resetFilterEnhanced')?.addEventListener('click', () => {
            this.resetFilter();
        });

        document.getElementById('exportDataBtn')?.addEventListener('click', () => {
            this.exportData();
        });
    }

    switchTab(tabType) {
        // Update tab buttons
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelector(`[data-type="${tabType}"]`).classList.add('active');

        // Update tab content
        document.querySelectorAll('.filter-tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tabType}-tab`).classList.add('active');

        this.currentTab = tabType;
        this.currentSelection.type = tabType;
        this.updateDisplay();
    }

    populateYearSelector() {
        const yearSelector = document.getElementById('year-selector');
        if (!yearSelector) return;

        const currentYear = new Date().getFullYear();
        
        // Add years from 2020 to current year + 2
        for (let year = 2020; year <= currentYear + 2; year++) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            if (year === currentYear) {
                option.selected = true;
            }
            yearSelector.appendChild(option);
        }
    }

    updateQuickLabels() {
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);

        // Format functions
        const formatDate = (date) => date.toLocaleDateString('ms-MY', {
            day: '2-digit',
            month: '2-digit'
        });

        const formatMonth = (date) => date.toLocaleDateString('ms-MY', {
            month: 'long',
            year: 'numeric'
        });

        // Update labels
        const updates = {
            'today-label': formatDate(today),
            'yesterday-label': formatDate(yesterday),
            'thisweek-label': this.getWeekLabel(today),
            'lastweek-label': this.getWeekLabel(new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)),
            'thismonth-label': formatMonth(today),
            'lastmonth-label': formatMonth(new Date(today.getFullYear(), today.getMonth() - 1, 1)),
            'thisyear-label': today.getFullYear().toString(),
            'lastyear-label': (today.getFullYear() - 1).toString()
        };

        Object.entries(updates).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) element.textContent = value;
        });
    }

    getWeekLabel(date) {
        const startOfWeek = new Date(date);
        startOfWeek.setDate(date.getDate() - date.getDay());
        const endOfWeek = new Date(startOfWeek);
        endOfWeek.setDate(startOfWeek.getDate() + 6);
        
        return `${startOfWeek.getDate()}/${startOfWeek.getMonth() + 1} - ${endOfWeek.getDate()}/${endOfWeek.getMonth() + 1}`;
    }

    setDefaultSelection() {
        // Set default to current month
        this.selectQuickPeriod('this-month');
    }

    selectQuickPeriod(period) {
        // Update button states
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-period="${period}"]`)?.classList.add('active');

        this.currentSelection.type = 'quick';
        this.currentSelection.value = period;
        this.updateDisplay();
    }

    onYearChange() {
        const yearSelector = document.getElementById('year-selector');
        const monthSelector = document.getElementById('month-selector');
        
        if (yearSelector.value) {
            monthSelector.disabled = false;
            this.currentSelection.year = parseInt(yearSelector.value);
            this.generateMonthQuickButtons();
        } else {
            monthSelector.disabled = true;
            monthSelector.value = '';
            this.disableDayInputs();
        }
        
        this.currentSelection.type = 'advanced';
        this.updateDisplay();
    }

    onMonthChange() {
        const monthSelector = document.getElementById('month-selector');
        const startDayInput = document.getElementById('start-day');
        const endDayInput = document.getElementById('end-day');
        
        if (monthSelector.value) {
            startDayInput.disabled = false;
            endDayInput.disabled = false;
            this.currentSelection.month = parseInt(monthSelector.value);
            
            // Set max days based on month
            const maxDays = new Date(this.currentSelection.year, this.currentSelection.month, 0).getDate();
            startDayInput.max = maxDays;
            endDayInput.max = maxDays;
        } else {
            this.disableDayInputs();
            this.currentSelection.month = null;
        }
        
        this.updateDisplay();
    }

    onDayRangeChange() {
        const startDay = document.getElementById('start-day').value;
        const endDay = document.getElementById('end-day').value;
        
        this.currentSelection.startDay = startDay ? parseInt(startDay) : null;
        this.currentSelection.endDay = endDay ? parseInt(endDay) : null;
        
        this.updateDisplay();
    }

    onCustomDateChange() {
        const startDate = document.getElementById('custom-start-date').value;
        const endDate = document.getElementById('custom-end-date').value;
        
        this.currentSelection.customStart = startDate;
        this.currentSelection.customEnd = endDate;
        this.currentSelection.type = 'custom';
        
        this.updateDisplay();
    }

    onAgentChange() {
        const agentSelect = document.getElementById('agent-filter-enhanced');
        this.currentSelection.agent = agentSelect.value;
        this.updateActiveFilters();
    }

    disableDayInputs() {
        document.getElementById('start-day').disabled = true;
        document.getElementById('end-day').disabled = true;
        document.getElementById('start-day').value = '';
        document.getElementById('end-day').value = '';
        this.currentSelection.startDay = null;
        this.currentSelection.endDay = null;
    }

    generateMonthQuickButtons() {
        const container = document.getElementById('month-quick-grid');
        if (!container) return;

        const months = [
            'Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun',
            'Jul', 'Ogo', 'Sep', 'Okt', 'Nov', 'Dis'
        ];

        container.innerHTML = months.map((month, index) => 
            `<button class="month-quick-btn" data-month="${index + 1}">${month}</button>`
        ).join('');

        // Add event listeners
        container.querySelectorAll('.month-quick-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('month-selector').value = btn.dataset.month;
                this.onMonthChange();
                
                // Update button states
                container.querySelectorAll('.month-quick-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
    }

    updateDisplay() {
        const { startDate, endDate, displayText, workingDays, totalDays } = this.getDateRange();
        
        // Update period display
        document.getElementById('periodTitle').textContent = displayText;
        document.getElementById('periodRange').textContent = `${startDate} to ${endDate}`;
        document.getElementById('period-days').textContent = `${totalDays} hari`;
        document.getElementById('period-working-days').textContent = `${workingDays} hari kerja`;
        
        this.updateActiveFilters();
    }

    getDateRange() {
        const today = new Date();
        let startDate, endDate, displayText;

        switch (this.currentSelection.type) {
            case 'quick':
                return this.getQuickDateRange(this.currentSelection.value);
                
            case 'advanced':
                return this.getAdvancedDateRange();
                
            case 'custom':
                return this.getCustomDateRange();
                
            default:
                return this.getQuickDateRange('this-month');
        }
    }

    getQuickDateRange(period) {
        const today = new Date();
        let startDate, endDate, displayText;

        switch (period) {
            case 'today':
                startDate = endDate = this.formatDate(today);
                displayText = 'Hari Ini';
                break;
                
            case 'yesterday':
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                startDate = endDate = this.formatDate(yesterday);
                displayText = 'Semalam';
                break;
                
            case 'this-week':
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay());
                startDate = this.formatDate(startOfWeek);
                endDate = this.formatDate(today);
                displayText = 'Minggu Ini';
                break;
                
            case 'last-week':
                const lastWeekEnd = new Date(today);
                lastWeekEnd.setDate(today.getDate() - today.getDay() - 1);
                const lastWeekStart = new Date(lastWeekEnd);
                lastWeekStart.setDate(lastWeekEnd.getDate() - 6);
                startDate = this.formatDate(lastWeekStart);
                endDate = this.formatDate(lastWeekEnd);
                displayText = 'Minggu Lepas';
                break;
                
            case 'this-month':
                const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                startDate = this.formatDate(startOfMonth);
                endDate = this.formatDate(today);
                displayText = `${this.getMonthName(today.getMonth())} ${today.getFullYear()}`;
                break;
                
            case 'last-month':
                const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                startDate = this.formatDate(lastMonth);
                endDate = this.formatDate(lastMonthEnd);
                displayText = `${this.getMonthName(lastMonth.getMonth())} ${lastMonth.getFullYear()}`;
                break;
                
            case 'this-year':
                const startOfYear = new Date(today.getFullYear(), 0, 1);
                startDate = this.formatDate(startOfYear);
                endDate = this.formatDate(today);
                displayText = `Tahun ${today.getFullYear()}`;
                break;
                
            case 'last-year':
                const lastYear = today.getFullYear() - 1;
                const startOfLastYear = new Date(lastYear, 0, 1);
                const endOfLastYear = new Date(lastYear, 11, 31);
                startDate = this.formatDate(startOfLastYear);
                endDate = this.formatDate(endOfLastYear);
                displayText = `Tahun ${lastYear}`;
                break;
                
            default:
                startDate = endDate = this.formatDate(today);
                displayText = 'Hari Ini';
        }

        const totalDays = this.calculateDaysDifference(startDate, endDate) + 1;
        const workingDays = this.calculateWorkingDays(startDate, endDate);

        return { startDate, endDate, displayText, totalDays, workingDays };
    }

    getAdvancedDateRange() {
        const { year, month, startDay, endDay } = this.currentSelection;
        
        if (!year) {
            return this.getQuickDateRange('this-month');
        }

        let startDate, endDate, displayText;

        if (month) {
            const monthStart = new Date(year, month - 1, startDay || 1);
            const monthEnd = new Date(year, month - 1, endDay || new Date(year, month, 0).getDate());
            
            startDate = this.formatDate(monthStart);
            endDate = this.formatDate(monthEnd);
            
            if (startDay && endDay) {
                displayText = `${startDay}-${endDay} ${this.getMonthName(month - 1)} ${year}`;
            } else if (startDay) {
                displayText = `Dari ${startDay} ${this.getMonthName(month - 1)} ${year}`;
            } else if (endDay) {
                displayText = `Hingga ${endDay} ${this.getMonthName(month - 1)} ${year}`;
            } else {
                displayText = `${this.getMonthName(month - 1)} ${year}`;
            }
        } else {
            // Whole year
            startDate = this.formatDate(new Date(year, 0, 1));
            endDate = this.formatDate(new Date(year, 11, 31));
            displayText = `Tahun ${year}`;
        }

        const totalDays = this.calculateDaysDifference(startDate, endDate) + 1;
        const workingDays = this.calculateWorkingDays(startDate, endDate);

        return { startDate, endDate, displayText, totalDays, workingDays };
    }

    getCustomDateRange() {
        const { customStart, customEnd } = this.currentSelection;
        
        if (!customStart || !customEnd) {
            return this.getQuickDateRange('this-month');
        }

        const startDate = customStart;
        const endDate = customEnd;
        const displayText = `Custom Range`;

        const totalDays = this.calculateDaysDifference(startDate, endDate) + 1;
        const workingDays = this.calculateWorkingDays(startDate, endDate);

        return { startDate, endDate, displayText, totalDays, workingDays };
    }

    formatDate(date) {
        return date.toISOString().split('T')[0]; // YYYY-MM-DD format
    }

    getMonthName(monthIndex) {
        const months = [
            'Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun',
            'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'
        ];
        return months[monthIndex];
    }

    calculateDaysDifference(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        const diffTime = Math.abs(end - start);
        return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }

    calculateWorkingDays(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        let workingDays = 0;
        
        for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
            const dayOfWeek = date.getDay();
            // Exclude Friday (5) and Saturday (6) for Malaysian working pattern
            if (dayOfWeek !== 5 && dayOfWeek !== 6) {
                workingDays++;
            }
        }
        
        return workingDays;
    }

    updateActiveFilters() {
        const { displayText } = this.getDateRange();
        const tags = [];

        // Add period tag
        tags.push({
            type: 'period',
            text: `Tempoh: ${displayText}`,
            value: 'period'
        });

        // Add agent tag if selected
        if (this.currentSelection.agent) {
            tags.push({
                type: 'agent',
                text: `Agent: ${this.currentSelection.agent}`,
                value: this.currentSelection.agent
            });
        }

        // Update display
        const activeFilters = document.getElementById('activeFiltersEnhanced');
        const filterTags = document.getElementById('filterTagsEnhanced');

        if (tags.length > 0) {
            activeFilters?.classList.remove('hidden');
            if (filterTags) {
                filterTags.innerHTML = tags.map(tag => 
                    `<span class="filter-tag">
                        ${tag.text}
                        <button class="remove-tag" data-type="${tag.type}" data-value="${tag.value}">×</button>
                    </span>`
                ).join('');

                // Add remove tag listeners
                filterTags.querySelectorAll('.remove-tag').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.removeFilter(btn.dataset.type);
                    });
                });
            }
        } else {
            activeFilters?.classList.add('hidden');
        }
    }

    removeFilter(type) {
        if (type === 'period') {
            this.setDefaultSelection();
        } else if (type === 'agent') {
            this.currentSelection.agent = '';
            const agentSelect = document.getElementById('agent-filter-enhanced');
            if (agentSelect) agentSelect.value = '';
        }
        this.updateActiveFilters();
    }

    applyFilter() {
        const applyBtn = document.getElementById('applyFilterEnhanced');
        const originalText = applyBtn.innerHTML;
        
        // Show loading state
        applyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
        applyBtn.disabled = true;

        const { startDate, endDate } = this.getDateRange();

        // Update global filters for dashboard integration
        if (window.currentFilters) {
            window.currentFilters.startDate = startDate;
            window.currentFilters.endDate = endDate;
            window.currentFilters.agent = this.currentSelection.agent;
        }

        // Apply filters using existing dashboard function
        setTimeout(() => {
            try {
                if (typeof window.applyFilters === 'function') {
                    // Update old filter inputs for backward compatibility
                    const startDateInput = document.getElementById('start-date');
                    const endDateInput = document.getElementById('end-date');
                    const agentFilterOld = document.getElementById('agent-filter');
                    
                    if (startDateInput) startDateInput.value = startDate;
                    if (endDateInput) endDateInput.value = endDate;
                    if (agentFilterOld) agentFilterOld.value = this.currentSelection.agent || '';

                    window.applyFilters();
                    
                    // Success feedback
                    applyBtn.innerHTML = '<i class="fas fa-check"></i> Berjaya!';
                    setTimeout(() => {
                        applyBtn.innerHTML = originalText;
                        applyBtn.disabled = false;
                    }, 1500);
                } else {
                    throw new Error('Dashboard applyFilters function not found');
                }
            } catch (error) {
                console.error('Error applying filters:', error);
                applyBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ralat!';
                setTimeout(() => {
                    applyBtn.innerHTML = originalText;
                    applyBtn.disabled = false;
                }, 2000);
            }
        }, 500);
    }

    resetFilter() {
        // Reset all selections
        this.currentSelection = {
            type: 'quick',
            value: 'this-month',
            year: null,
            month: null,
            startDay: null,
            endDay: null,
            customStart: null,
            customEnd: null,
            agent: null
        };

        // Reset UI elements
        document.getElementById('year-selector').value = '';
        document.getElementById('month-selector').value = '';
        document.getElementById('month-selector').disabled = true;
        this.disableDayInputs();
        document.getElementById('custom-start-date').value = '';
        document.getElementById('custom-end-date').value = '';
        document.getElementById('agent-filter-enhanced').value = '';

        // Switch back to quick tab and select default
        this.switchTab('quick');
        this.setDefaultSelection();

        // Reset global filters
        if (typeof window.clearFilters === 'function') {
            window.clearFilters();
        }

        // Visual feedback
        const resetBtn = document.getElementById('resetFilterEnhanced');
        const originalText = resetBtn.innerHTML;
        resetBtn.innerHTML = '<i class="fas fa-check"></i> Reset!';
        setTimeout(() => {
            resetBtn.innerHTML = originalText;
        }, 1000);
    }

    exportData() {
        const { startDate, endDate, displayText } = this.getDateRange();
        
        // This would integrate with your export functionality
        console.log('Exporting data for:', {
            period: displayText,
            startDate,
            endDate,
            agent: this.currentSelection.agent
        });
        
        // You can implement actual export logic here
        alert(`Export data untuk tempoh: ${displayText}\nDari: ${startDate}\nHingga: ${endDate}`);
    }

    // Public methods for external integration
    getSelection() {
        const { startDate, endDate, displayText } = this.getDateRange();
        return {
            startDate,
            endDate,
            agent: this.currentSelection.agent || '',
            displayText,
            type: this.currentSelection.type,
            details: this.currentSelection
        };
    }

    populateAgentOptions(agents) {
        const agentSelect = document.getElementById('agent-filter-enhanced');
        if (!agentSelect) return;

        // Clear existing options except the first one
        agentSelect.innerHTML = '<option value="">Semua Agent</option>';

        // Add agent options
        agents.forEach(agent => {
            const option = document.createElement('option');
            option.value = agent;
            option.textContent = agent;
            agentSelect.appendChild(option);
        });
    }
}

// Initialize when DOM is ready
let advancedDashboardFilter;

document.addEventListener('DOMContentLoaded', () => {
    advancedDashboardFilter = new AdvancedDashboardFilter();
    
    // Make globally available
    window.advancedDashboardFilter = advancedDashboardFilter;
    window.getEnhancedFilterSelection = () => advancedDashboardFilter.getSelection();
    window.populateEnhancedAgentFilter = (agents) => advancedDashboardFilter.populateAgentOptions(agents);
});

console.log('🎯 Advanced Dashboard Filter loaded!');
console.log('📊 Features: Year/Month/Day selection, Quick periods, Custom range, Agent filter');
    </script>
</body>
</html>